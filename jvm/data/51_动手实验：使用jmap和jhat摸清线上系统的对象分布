{"code":0,"msg":"ok","data":{"app_id":"apppuKyPtrl1086","id":"i_5d11e6dcd1665_1IHaAzB3","title":"051、动手实验：使用jmap和jhat摸清线上系统的对象分布","author":"","img_url":"http://wechatapppro-1252524126.file.myqcloud.com/apppuKyPtrl1086/image/cmVzb3VyY2UtY291cnNlQXJ0aWNsZS0zNzA0NzEwOQ.png","img_url_compressed_larger":"http://wechatapppro-1252524126.file.myqcloud.com/apppuKyPtrl1086/image/compress/larger_cmVzb3VyY2UtY291cnNlQXJ0aWNsZS0zNzA0NzEwOQ.png","img_url_compressed":"http://wechatapppro-1252524126.file.myqcloud.com/apppuKyPtrl1086/image/compress/414312cmVzb3VyY2UtY291cnNlQXJ0aWNsZS0zNzA0NzEwOQ.png","content":"<p style="white-space:normal;text-align:left;line-height:2em;"><span style="font-weight:bolder;color:rgb(118,146,60);"></span><span style="color:rgb(118,146,60);"><strong><span style="font-size:17px;line-height:1.5;">动手实验：</span></strong></span></p><p style="white-space:normal;line-height:2em;text-align:left;"><span style="color:rgb(118,146,60);"><strong><span style="color:rgb(118,146,60);font-size:17px;line-height:1.5;">使用jmap和jhat摸清线上系统的对象分布</span></strong></span></p><hr/><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;">给各位小伙伴推荐我的最新专栏：《从零开始带你成为MySQL实战优化高手》：</p><p style="margin-bottom:15px;font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><img src="http://wechatapppro-1252524126.file.myqcloud.com/image/ueditor/65917400_1578303728.jpg" title=".jpg" alt="小封面.jpg" width="100%" height="auto"/><span style="font-weight:bolder;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="text-indent:140px;">该专栏延续了JVM专栏的思路：从零开始、一步一图</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="text-indent:140px;">通过46个我亲身经历的线上案例，全面覆盖了MySQL生产中性能优化、分库分表等各种问题。</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="text-indent:140px;">如果你觉得JVM专栏是你的菜，那么MySQL专栏一定不会让你失望的</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";text-align:center;"><span style="text-indent:140px;">（点击下方蓝字试听）</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";text-align:center;"><a href="https://apppukyptrl1086.pc.xiaoe-tech.com/detail/p_5e0c2a35dbbc9_MNDGDYba/6?fromH5=true" target="_blank" title="《从零开始带你成为MySQL实战优化高手》">《从零开始带你成为MySQL实战优化高手》</a></p><p style="margin-bottom:15px;white-space:normal;line-height:2em;"><br/></p><p style="white-space:normal;line-height:2em;"><span style="font-weight:bolder;color:rgb(255,0,0);"></span><br/></p><hr/><p style="margin-bottom:20px;white-space:normal;text-align:left;line-height:2em;"><br/></p><p style="margin-bottom:20px;white-space:normal;line-height:2em;"><span style="font-weight:bolder;font-size:20px;line-height:1.5;color:rgb(118,146,60);"></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">1、前文总结</span></p><p style="line-height:2em;"><span class="author-p-53348239">上一篇文章我们给大家介绍了一个平时工作中非常实用的工具，jstat。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">用jstat就可以非常轻松便捷的了解到线上系统的运行状况，从新对象增速、Young GC触发频率以及耗时，再到对象进入老年代的增速以及Full GC触发频率以及耗时，可以完全摸清楚线上系统的JVM运行情况，为可能要做的优化做准备。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">本文我们继续给大家介绍两个平时工作里非常实用的工具，jmap和jhat。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这两个工具可以帮助我们观察线上JVM中的对象分布，了解到你的系统平时运行过程中，到底哪些对象占据了主角位置，他们占据了多少内存空间，让你对你的系统运行有更加细致的了解。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">2、使用jmap了解系统运行时的内存区域</span></p><p style="line-height:2em;"><span class="author-p-53348239">其实如果单单只是要了解JVM的运行状况，然后去进行JVM GC优化，通常来说jstat就完全够用了</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">但是有的时候可能我们会发现JVM新增对象的速度很快，然后就想要去看看，<strong>到底什么对象占据了那么多的内存。</strong></span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">如果发现有的对象在代码中可以优化一下创建的时机，避免那种对象对内存占用过大，那么也许甚至可以去反过来优化一下代码。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">当然，其实如果不是出现OOM那种极端情况，也并没有那么大的必要去着急优化代码。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">但是这篇文章我们来学习一下如何了解线上系统jvm中的对象分布，也是有好处的，比如之前我们在上周的案例中就发现年轻代里总是有500kb左右的未知对象，大家是不是会很好奇？如果可以看到jvm中这500kb的对象到底是什么就好了，所以学习一下这个技巧是有用的。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">先看一个命令：<strong>jmap -heap PID</strong></span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这个命令可以打印出来一系列的信息，我们就不长篇大论的粘贴出来具体的信息了，因为内容篇幅太大了，其实也没太大意义，因为里面的东西大家自己看字面意思都能看懂的。我们就简单给大家说一下这里会打印出来什么东西。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">大致来说，这个信息会打印出来堆内存相关的一些参数设置，然后就是当前堆内存里的一些基本各个区域的情况</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">比如Eden区总容量、已经使用的容量、剩余的空间容量，两个Survivor区的总容量、已经使用的容量和剩余的空间容量，老年代的总容量、已经使用的容量和剩余的容量。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">但是这些信息大家会想了，其实jstat已经有了啊！对的，所以一般不会用jmap去看这些信息，毕竟他信息还没jstat全呢，因为没有gc相关的统计。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">3、使用jmap了解系统运行时的对象分布</span></p><p style="line-height:2em;"><span class="author-p-53348239">其实jmap命令比较有用的一个使用方式，是如下的：</span></p><p style="line-height:2em;"><strong><span class="author-p-53348239">jmap -histo PID</span></strong></p><p style="line-height:2em;"><strong><span class="author-p-53348239"><br/></span></strong></p><p style="line-height:2em;"><span class="author-p-53348239">这个命令会打印出来类似下面的信息：</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239"><img src="http://wechatapppro-1252524126.file.myqcloud.com/image/ueditor/78916800_1578303728.png" title=".png" alt="image.png"/></span></p><p style="line-height:2em;"><br/></p><p style="line-height:2em;"><span class="author-p-53348239">这个就很有意思了，各位同学看上述打印出来的东西，他会按照各种对象占用内存空间的大小降序排列，把占用内存最多的对象放在最上面。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">所以如果你只是想要简单的了解一下当前jvm中的对象对内存占用的情况，只要直接用jmap -histo命令即可，非常好用</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">你可以快速了解到当前内存里到底是哪个对象占用了大量的内存空间。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">4、使用jmap生成堆内存转储快照</span></p><p style="line-height:2em;"><span class="author-p-53348239">但是如果你仅仅只是看一个大概，感觉就只是看看上述那些对象占用内存的情况，感觉还不够，想要来点深入而且仔细点的</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">那就可以用jmap命令生成一个堆内存快照放到一个文件里去，用如下的命令即可：</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><strong><span class="author-p-53348239">jmap -dump:live,format=b,file=dump.hprof PID</span></strong></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这个命令会在当前目录下生成一个dump.hrpof文件，这里是二进制的格式，你不能直接打开看的，他把这一时刻JVM堆内存里所有对象的快照放到文件里去了，供你后续去分析。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">5、使用jhat在浏览器中分析堆转出快照</span></p><p style="line-height:2em;"><span class="author-p-53348239">接着就可以使用jhat去分析堆快照了，jhat内置了web服务器，他会支持你通过浏览器来以图形化的方式分析堆转储快照</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">使用如下命令即可启动jhat服务器，还可以指定自己想要的http端口号，默认是7000端口号：</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><strong><span class="author-p-53348239">jhat dump.hprof -port 7000</span></strong></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">接着你就在浏览器上访问当前这台机器的7000端口号，就可以通过图形化的方式去分析堆内存里的对象分布情况了。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这里我们先简单介绍一下，后面马上有两个案例，jstat、jmap、jhat我们都会带着大家动手来玩一下的。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">6、今日思考题</span></p><p style="line-height:2em;"><span class="author-p-53348239">今天留给大家的作业，就是自己去线上系统的机器上，用jmap -histo看看对象大致分布情况，然后用jmap生成一个堆转储快照，再用jhat分析一下堆转储快照，看看当前系统运行的时候，各种对象的分布情况。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">大家可以到评论区里说说自己看堆转储快照的感受，是不是发现自己越来越了解JVM是如何运行的了呢？</span></p><p style="margin-bottom:20px;white-space:normal;line-height:2em;text-align:center;"><span style="font-weight:bolder;font-size:20px;line-height:1.5;color:rgb(118,146,60);"></span></p><p style="white-space:normal;text-align:center;line-height:2em;"><span style="font-size:20px;line-height:1.5;"><span style="font-weight:bolder;"><span style="line-height:1.5;"></span></span></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";text-align:center;"><span style="font-size:20px;line-height:1.5;font-weight:bolder;color:rgb(255,0,0);">End</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="font-size:13px;line-height:1.5;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="line-height:1.5;">专栏版权归公众号<span style="line-height:1.5;font-weight:bolder;">狸猫技术窝</span>所有</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="line-height:1.5;">未经许可不得传播，如有侵权将追究法律责任</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="line-height:1.5;"></span></p><hr/><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="color:rgb(192,80,77);font-weight:bolder;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;">狸猫技术窝精品专栏及课程推荐：<br/></p><ul class="list-paddingleft-2" style="list-style-type:disc;padding-left:30px;"><li><p><span style="text-decoration:underline;font-size:15px;line-height:1.5;"><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d887e7ea3adc_KDm4nxCm?type=3" target="_self" title="从零开始带你成为消息中间件实战高手" style="line-height:1.5;">《从零开始带你成为消息中间件实战高手》</a></span></p></li><li><p><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d3110c3c0e9d_FnmTTtj4?type=3" target="_self" title="21天互联网Java进阶面试训练营（分布式篇）" style="text-decoration-line:underline;font-size:15px;line-height:1.5;"><span style="line-height:1.5;">《21天互联网Java进阶面试训练营》（分布式篇）</span></a></p></li><li><p><span style="text-decoration:underline;font-size:15px;line-height:1.5;"><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d3114935b4d7_CEcL8yMS?type=3" target="_self" title="《互联网Java工程师面试突击》（第1季）" style="line-height:1.5;">《互联网Java工程师面试突击》（第1季）</a></span></p></li><li><p><a href="https://apppukyptrl1086.pc.xiaoe-tech.com/detail/p_5dd3ccd673073_9LnpmMju/6?fromH5=true" target="_blank" title="《互联网Java工程师面试突击》（第3季）" style="text-decoration-line:underline;font-size:15px;line-height:1.5;"><span style="line-height:1.5;">《互联网Java工程师面试突击》（第3季）</span></a><br/></p></li></ul><hr/><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="font-size:15px;line-height:1.5;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="color:rgb(192,0,0);"><span style="font-weight:bolder;">重要说明：</span></span></p><ul class="list-paddingleft-2" style="list-style-type:disc;padding-left:30px;"><li><p style="line-height:2em;">如何提问：每篇文章都有评论区，大家可以尽情留言提问，我会逐一答疑<br/></p></li><li><p style="line-height:2em;">如何加群：购买狸猫技术窝专栏的小伙伴都可以加入狸猫技术交流群，一个非常纯粹的技术交流的地方</p></li></ul><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="color:rgb(255,0,0);"><span style="font-size:14px;line-height:1.5;color:rgb(79,129,189);"><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d3110c3c0e9d_FnmTTtj4?type=3" target="_self" title="21天互联网java进阶面试训练营（分布式篇）"><span style="font-size:12px;line-height:1.5;color:rgb(79,129,189);"></span></a></span></span></p><p style="margin-left:28px;font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="font-size:15px;line-height:1.5;"><span style="line-height:1.5;font-family:微软雅黑;">具体加群方式，请参见目录菜单下的文档：《付费用户如何加群》（</span><span style="font-weight:bolder;"><span style="line-height:1.5;font-family:微软雅黑;">购买后可见</span></span><span style="line-height:1.5;font-family:微软雅黑;">）</span></span></p><p><span style="font-size:15px;line-height:1.5;"><span style="line-height:1.5;font-family:微软雅黑;"><br/></span></span></p><p style="white-space:normal;text-align:center;line-height:2em;"><br/></p>","org_content":"<p style="white-space:normal;text-align:left;line-height:2em;"><span style="font-weight:bolder;color:rgb(118,146,60);"></span><span style="color:rgb(118,146,60);"><strong><span style="font-size:17px;line-height:1.5;">动手实验：</span></strong></span></p><p style="white-space:normal;line-height:2em;text-align:left;"><span style="color:rgb(118,146,60);"><strong><span style="color:rgb(118,146,60);font-size:17px;line-height:1.5;">使用jmap和jhat摸清线上系统的对象分布</span></strong></span></p><hr/><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;">给各位小伙伴推荐我的最新专栏：《从零开始带你成为MySQL实战优化高手》：</p><p style="margin-bottom:15px;font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><img src="http://wechatapppro-1252524126.file.myqcloud.com/image/ueditor/65917400_1578303728.jpg" title=".jpg" alt="小封面.jpg" width="100%" height="auto"/><span style="font-weight:bolder;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="text-indent:140px;">该专栏延续了JVM专栏的思路：从零开始、一步一图</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="text-indent:140px;">通过46个我亲身经历的线上案例，全面覆盖了MySQL生产中性能优化、分库分表等各种问题。</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="text-indent:140px;">如果你觉得JVM专栏是你的菜，那么MySQL专栏一定不会让你失望的</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";text-align:center;"><span style="text-indent:140px;">（点击下方蓝字试听）</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";text-align:center;"><a href="https://apppukyptrl1086.pc.xiaoe-tech.com/detail/p_5e0c2a35dbbc9_MNDGDYba/6?fromH5=true" target="_blank" title="《从零开始带你成为MySQL实战优化高手》">《从零开始带你成为MySQL实战优化高手》</a></p><p style="margin-bottom:15px;white-space:normal;line-height:2em;"><br/></p><p style="white-space:normal;line-height:2em;"><span style="font-weight:bolder;color:rgb(255,0,0);"></span><br/></p><hr/><p style="margin-bottom:20px;white-space:normal;text-align:left;line-height:2em;"><br/></p><p style="margin-bottom:20px;white-space:normal;line-height:2em;"><span style="font-weight:bolder;font-size:20px;line-height:1.5;color:rgb(118,146,60);"></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">1、前文总结</span></p><p style="line-height:2em;"><span class="author-p-53348239">上一篇文章我们给大家介绍了一个平时工作中非常实用的工具，jstat。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">用jstat就可以非常轻松便捷的了解到线上系统的运行状况，从新对象增速、Young GC触发频率以及耗时，再到对象进入老年代的增速以及Full GC触发频率以及耗时，可以完全摸清楚线上系统的JVM运行情况，为可能要做的优化做准备。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">本文我们继续给大家介绍两个平时工作里非常实用的工具，jmap和jhat。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这两个工具可以帮助我们观察线上JVM中的对象分布，了解到你的系统平时运行过程中，到底哪些对象占据了主角位置，他们占据了多少内存空间，让你对你的系统运行有更加细致的了解。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">2、使用jmap了解系统运行时的内存区域</span></p><p style="line-height:2em;"><span class="author-p-53348239">其实如果单单只是要了解JVM的运行状况，然后去进行JVM GC优化，通常来说jstat就完全够用了</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">但是有的时候可能我们会发现JVM新增对象的速度很快，然后就想要去看看，<strong>到底什么对象占据了那么多的内存。</strong></span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">如果发现有的对象在代码中可以优化一下创建的时机，避免那种对象对内存占用过大，那么也许甚至可以去反过来优化一下代码。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">当然，其实如果不是出现OOM那种极端情况，也并没有那么大的必要去着急优化代码。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">但是这篇文章我们来学习一下如何了解线上系统jvm中的对象分布，也是有好处的，比如之前我们在上周的案例中就发现年轻代里总是有500kb左右的未知对象，大家是不是会很好奇？如果可以看到jvm中这500kb的对象到底是什么就好了，所以学习一下这个技巧是有用的。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">先看一个命令：<strong>jmap -heap PID</strong></span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这个命令可以打印出来一系列的信息，我们就不长篇大论的粘贴出来具体的信息了，因为内容篇幅太大了，其实也没太大意义，因为里面的东西大家自己看字面意思都能看懂的。我们就简单给大家说一下这里会打印出来什么东西。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">大致来说，这个信息会打印出来堆内存相关的一些参数设置，然后就是当前堆内存里的一些基本各个区域的情况</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">比如Eden区总容量、已经使用的容量、剩余的空间容量，两个Survivor区的总容量、已经使用的容量和剩余的空间容量，老年代的总容量、已经使用的容量和剩余的容量。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">但是这些信息大家会想了，其实jstat已经有了啊！对的，所以一般不会用jmap去看这些信息，毕竟他信息还没jstat全呢，因为没有gc相关的统计。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">3、使用jmap了解系统运行时的对象分布</span></p><p style="line-height:2em;"><span class="author-p-53348239">其实jmap命令比较有用的一个使用方式，是如下的：</span></p><p style="line-height:2em;"><strong><span class="author-p-53348239">jmap -histo PID</span></strong></p><p style="line-height:2em;"><strong><span class="author-p-53348239"><br/></span></strong></p><p style="line-height:2em;"><span class="author-p-53348239">这个命令会打印出来类似下面的信息：</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239"><img src="http://wechatapppro-1252524126.file.myqcloud.com/image/ueditor/78916800_1578303728.png" title=".png" alt="image.png"/></span></p><p style="line-height:2em;"><br/></p><p style="line-height:2em;"><span class="author-p-53348239">这个就很有意思了，各位同学看上述打印出来的东西，他会按照各种对象占用内存空间的大小降序排列，把占用内存最多的对象放在最上面。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">所以如果你只是想要简单的了解一下当前jvm中的对象对内存占用的情况，只要直接用jmap -histo命令即可，非常好用</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">你可以快速了解到当前内存里到底是哪个对象占用了大量的内存空间。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">4、使用jmap生成堆内存转储快照</span></p><p style="line-height:2em;"><span class="author-p-53348239">但是如果你仅仅只是看一个大概，感觉就只是看看上述那些对象占用内存的情况，感觉还不够，想要来点深入而且仔细点的</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">那就可以用jmap命令生成一个堆内存快照放到一个文件里去，用如下的命令即可：</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><strong><span class="author-p-53348239">jmap -dump:live,format=b,file=dump.hprof PID</span></strong></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这个命令会在当前目录下生成一个dump.hrpof文件，这里是二进制的格式，你不能直接打开看的，他把这一时刻JVM堆内存里所有对象的快照放到文件里去了，供你后续去分析。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">5、使用jhat在浏览器中分析堆转出快照</span></p><p style="line-height:2em;"><span class="author-p-53348239">接着就可以使用jhat去分析堆快照了，jhat内置了web服务器，他会支持你通过浏览器来以图形化的方式分析堆转储快照</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">使用如下命令即可启动jhat服务器，还可以指定自己想要的http端口号，默认是7000端口号：</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><strong><span class="author-p-53348239">jhat dump.hprof -port 7000</span></strong></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">接着你就在浏览器上访问当前这台机器的7000端口号，就可以通过图形化的方式去分析堆内存里的对象分布情况了。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">这里我们先简单介绍一下，后面马上有两个案例，jstat、jmap、jhat我们都会带着大家动手来玩一下的。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span style="font-weight:bold;" class="author-p-53348239bold:true">6、今日思考题</span></p><p style="line-height:2em;"><span class="author-p-53348239">今天留给大家的作业，就是自己去线上系统的机器上，用jmap -histo看看对象大致分布情况，然后用jmap生成一个堆转储快照，再用jhat分析一下堆转储快照，看看当前系统运行的时候，各种对象的分布情况。</span></p><p style="line-height:2em;"><span class="author-p-53348239"><br/></span></p><p style="line-height:2em;"><span class="author-p-53348239">大家可以到评论区里说说自己看堆转储快照的感受，是不是发现自己越来越了解JVM是如何运行的了呢？</span></p><p style="margin-bottom:20px;white-space:normal;line-height:2em;text-align:center;"><span style="font-weight:bolder;font-size:20px;line-height:1.5;color:rgb(118,146,60);"></span></p><p style="white-space:normal;text-align:center;line-height:2em;"><span style="font-size:20px;line-height:1.5;"><span style="font-weight:bolder;"><span style="line-height:1.5;"></span></span></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";text-align:center;"><span style="font-size:20px;line-height:1.5;font-weight:bolder;color:rgb(255,0,0);">End</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="font-size:13px;line-height:1.5;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="line-height:1.5;">专栏版权归公众号<span style="line-height:1.5;font-weight:bolder;">狸猫技术窝</span>所有</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="line-height:1.5;">未经许可不得传播，如有侵权将追究法律责任</span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;"><span style="line-height:1.5;"></span></p><hr/><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="color:rgb(192,80,77);font-weight:bolder;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";line-height:2em;">狸猫技术窝精品专栏及课程推荐：<br/></p><ul class="list-paddingleft-2" style="list-style-type:disc;padding-left:30px;"><li><p><span style="text-decoration:underline;font-size:15px;line-height:1.5;"><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d887e7ea3adc_KDm4nxCm?type=3" target="_self" title="从零开始带你成为消息中间件实战高手" style="line-height:1.5;">《从零开始带你成为消息中间件实战高手》</a></span></p></li><li><p><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d3110c3c0e9d_FnmTTtj4?type=3" target="_self" title="21天互联网Java进阶面试训练营（分布式篇）" style="text-decoration-line:underline;font-size:15px;line-height:1.5;"><span style="line-height:1.5;">《21天互联网Java进阶面试训练营》（分布式篇）</span></a></p></li><li><p><span style="text-decoration:underline;font-size:15px;line-height:1.5;"><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d3114935b4d7_CEcL8yMS?type=3" target="_self" title="《互联网Java工程师面试突击》（第1季）" style="line-height:1.5;">《互联网Java工程师面试突击》（第1季）</a></span></p></li><li><p><a href="https://apppukyptrl1086.pc.xiaoe-tech.com/detail/p_5dd3ccd673073_9LnpmMju/6?fromH5=true" target="_blank" title="《互联网Java工程师面试突击》（第3季）" style="text-decoration-line:underline;font-size:15px;line-height:1.5;"><span style="line-height:1.5;">《互联网Java工程师面试突击》（第3季）</span></a><br/></p></li></ul><hr/><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="font-size:15px;line-height:1.5;"></span></p><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="color:rgb(192,0,0);"><span style="font-weight:bolder;">重要说明：</span></span></p><ul class="list-paddingleft-2" style="list-style-type:disc;padding-left:30px;"><li><p style="line-height:2em;">如何提问：每篇文章都有评论区，大家可以尽情留言提问，我会逐一答疑<br/></p></li><li><p style="line-height:2em;">如何加群：购买狸猫技术窝专栏的小伙伴都可以加入狸猫技术交流群，一个非常纯粹的技术交流的地方</p></li></ul><p style="font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="color:rgb(255,0,0);"><span style="font-size:14px;line-height:1.5;color:rgb(79,129,189);"><a href="https://apppukyptrl1086.h5.xiaoeknow.com/v1/course/column/p_5d3110c3c0e9d_FnmTTtj4?type=3" target="_self" title="21天互联网java进阶面试训练营（分布式篇）"><span style="font-size:12px;line-height:1.5;color:rgb(79,129,189);"></span></a></span></span></p><p style="margin-left:28px;font-size:medium;white-space:normal;font-family:"Microsoft YaHei";"><span style="font-size:15px;line-height:1.5;"><span style="line-height:1.5;font-family:微软雅黑;">具体加群方式，请参见目录菜单下的文档：《付费用户如何加群》（</span><span style="font-weight:bolder;"><span style="line-height:1.5;font-family:微软雅黑;">购买后可见</span></span><span style="line-height:1.5;font-family:微软雅黑;">）</span></span></p><p><span style="font-size:15px;line-height:1.5;"><span style="line-height:1.5;font-family:微软雅黑;"><br/></span></span></p><p style="white-space:normal;text-align:center;line-height:2em;"><br/></p>","try_content":"[]","try_org_content":"","start_at":"2019-08-20 07:00:00","stop_at":null,"state":0,"recycle_bin_state":0,"old_recycle_bin_state":0,"sell_mode":0,"view_count":4861,"payment_type":3,"price":8800,"line_price":0,"is_stop_sell":0,"period":0,"can_select":0,"img_size_total":0.704,"resource_type":1,"Id":"i_5d11e6dcd1665_1IHaAzB3","ResourceType":1,"resource_id":"i_5d11e6dcd1665_1IHaAzB3","video_m3u8":"","patch_img_url":"","patch_img_url_compressed":"","summary":"","sell_type":0,"purchase_count":0,"stock":0,"content_type":0,"audio_url":"","audio_size":0,"audio_length":0,"m3u8_url":"","audio_compress_url":"","try_audio_url":"","try_m3u8_url":"","try_audio_length":0,"length":0,"video_mp4":"","video_hls":"","video_size":0,"video_mp4_high":"","video_mp4_size":0,"video_length":0,"zb_stop_at":"","alive_status":0,"zb_start_at":"","manual_stop_at":"","total_chapters":0,"epub_url":"","epub_opf":"","epub_catalog":"","opf_catalog":"","catalog":"","file_from":0,"comment_count":35,"resource_count":0,"is_member":0,"member_type":0,"update_status":0,"finish_count":0,"finished_state":0,"visible_on":0,"alive_type":0,"have_password":0,"is_drm":0,"has_buy":1,"zb_start_rest_time":0,"is_company":0,"audio_play_time":0,"audio_play_count":0,"member_unit":"","member_expire_time":"","time_left":0,"available":true,"audio_m3u8":"","is_try":0,"img_url_compress":"","download_count":0,"can_view":0,"audio_m3u8_url":"","periodical_count":0,"sale_status":0,"init_price":8800,"left_time":0,"alive_start_rest_time":0,"is_free":0,"share_info":{"wx":{"share_url":"https://apppuKyPtrl1086.h5.xiaoeknow.com/content_page/eyJhcHBfaWQiOiJhcHBwdUt5UHRybDEwODYiLCJzaGFyZV9mcm9tIjoidV81ZDE5NWM1ZDEyNDZlXzU4NFREQk9ta04iLCJwcm9kdWN0X2lkIjoiIiwicmVzb3VyY2VfaWQiOiJpXzVkMTFlNmRjZDE2NjVfMUlIYUF6QjMiLCJ0eXBlIjoyLCJyZXNvdXJjZV90eXBlIjoxLCJzaGFyZV9hZ2VudCI6InBjIiwiZmVhdHVyZSI6IiIsImNvbnRlbnRfYXBwX2lkIjoiIiwic291cmNlIjoiIn0=","short_url":"https://apppuKyPtrl1086.h5.xeknow.com/st/8E2w69n2v","wx_app_qrcode":"http://wechatappdev-1252524126.file.myqcloud.com/apppuKyPtrl1086/image/bW9kdWxlZGVmYXVsdC1wYWdlZGVmYXVsdC11XzEyMzQ1Njc4OTEwMTFfMTIzNDU2Nzg5MS1pZmpjUVhGYg.jpg"}},"favorites_info":{"favorite_count":0,"is_favorite":0},"company_info":{"shop_id":"","company_id":"","vip_id":"","name":"","title":"","logo":"","cover_img":"","state":0,"expired_at":""},"shop_module":{"need_comment_check":1,"hide_comment_count":0,"hide_view_count":0,"hide_sub_count":1,"authentic_state":1,"is_show_resourcecount":1},"is_login":true,"resource_info":{"seo_description":""},"content_page_seo":0}}
